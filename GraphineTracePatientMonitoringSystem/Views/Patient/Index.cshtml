@model GraphineTracePatientMonitoringSystem.Models.PatientDashboardViewModel

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Patient Dashboard";
}

<div class="gt-frame">

    <h2 class="page-title">Patient Dashboard</h2>

    <div class="row">
        <!-- Left column: vitals + patient info -->
        <div class="col-lg-4 mb-3">
            <div class="card gt-card mb-3">
                <div class="card-body">
                    <p class="card-label mb-1">Heart Rate</p>
                    <div class="d-flex justify-content-between align-items-baseline">
                        <span class="card-number">98</span>
                        <span class="card-unit">bpm</span>
                        <span class="card-pill pill-normal">Normal</span>
                    </div>
                </div>
            </div>

            <div class="card gt-card mb-3">
                <div class="card-body">
                    <p class="card-label mb-1">Blood Pressure</p>
                    <div class="d-flex justify-content-between align-items-baseline">
                        <span class="card-number">102 / 72</span>
                        <span class="card-unit">mmHg</span>
                        <span class="card-pill pill-normal">Normal</span>
                    </div>
                </div>
            </div>

            <div class="card gt-card">
                <div class="card-body">
                    <p class="card-label mb-1">Patient</p>
                    <p><strong>Name:</strong> Dexter Morgan</p>
                    <p><strong>Age:</strong> 65 years old</p>
                    <p><strong>Disease:</strong> Hypertension</p>
                    <p><strong>Cause:</strong> Disabled, bedridden</p>
                </div>
            </div>
        </div>

        <!-- Right column: heat map + metrics + comments -->
        <div class="col-lg-8 mb-3">
            <div class="card gt-card mb-3">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h5 class="mb-0">Patient Analysis – Pressure Map (32×32 grid)</h5>

                        @if (Model.HasHighPressureAlert)
                        {
                            <span class="badge bg-danger">ALERT</span>
                        }
                        else
                        {
                            <span class="badge bg-success">OK</span>
                        }
                    </div>

                    <p class="text-muted small mb-3">
                        @Model.AlertMessage
                    </p>

                    <div class="row">
                        <div class="col-md-8">
                            <!-- Heat map -->
                            <div class="heatmap-wrapper">
                                <div class="heatmap-grid">
                                    @for (int row = 0; row < 32; row++)
                                    {
                                        for (int col = 0; col < 32; col++)
                                        {
                                            int value = Model.HeatMapValues[row, col];

                                            string levelClass;
                                            if (value < 100)
                                            {
                                                levelClass = "heat-low";
                                            }
                                            else if (value < 180)
                                            {
                                                levelClass = "heat-medium";
                                            }
                                            else
                                            {
                                                levelClass = "heat-high";
                                            }

                                            <div class="heat-cell @levelClass" title="@value"></div>
                                        }
                                    }
                                </div>
                                <div class="text-center small text-muted mt-2">
                                    Each cell = 1 pressure sensor (1–255). 32×32 matrix.
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="metric-card mb-2">
                                <span class="metric-label">Peak Pressure Index</span>
                                <span class="metric-value">@Model.PeakPressureIndex</span>
                            </div>
                            <div class="metric-card mb-2">
                                <span class="metric-label">Contact Area %</span>
                                <span class="metric-value">@Model.ContactAreaPercent%</span>
                            </div>
                            <div class="metric-card mb-2">
                                <span class="metric-label">Max Pressure Value</span>
                                <span class="metric-value">@Model.MaxPressureValue</span>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-3">
                        <div class="col-md-4">
                            <label class="form-label small">Time range</label>
                            <select class="form-select form-select-sm">
                                <option>Last hour</option>
                                <option>Last 6 hours</option>
                                <option>Last 24 hours</option>
                            </select>
                        </div>
                    </div>

                    <hr />

                    <div class="mt-3">
                        <h6>Comments</h6>
                        <div class="mb-2">
                            <textarea class="form-control" rows="3"
                                      placeholder="Add clinical comment about this heat map..."></textarea>
                        </div>
                        <button class="btn btn-sm btn-primary">Post</button>

                        <div class="comment-list mt-3">
                            <div class="comment-item">
                                <div class="comment-header">
                                    <strong>Dr. Smith</strong>
                                    <span class="comment-time">2:34 PM</span>
                                </div>
                                <p class="comment-text">
                                    Elevated pressure in heel region. Recommend repositioning every 2 hours.
                                </p>
                                <div class="comment-reply">
                                    <strong>Nurse Johnson</strong>
                                    <span class="comment-time">3:15 PM</span>
                                    <p class="comment-text mb-0">
                                        Noted. Will adjust care plan accordingly.
                                    </p>
                                </div>
                            </div>

                            <div class="comment-item">
                                <div class="comment-header">
                                    <strong>Dr. Martinez</strong>
                                    <span class="comment-time">Yesterday, 9:12 AM</span>
                                </div>
                                <p class="comment-text">
                                    Patient shows improvement compared to previous 24h period.
                                </p>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

    </div>
</div>
